(function($){function ping(){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200||xmlhttp.status==304){var _location=xmlhttp.responseURL;if(endWith(_location,"login")){window.location.href=_location}}else{alert("主机连接失败！")}}};xmlhttp.open("GET","../ping?t="+Math.random(),true);xmlhttp.send()}function endWith(s1,s){if(s==null||s==""||s1.length==0||s.length>s1.length){return false}if(s1.substring(s1.length-s.length)==s){return true}else{return false}}var random=Math.floor((Math.random()*5)+1);var ping=setInterval(ping,(10+random)*60000);$.fn.downCount=function(options,callback){var settings=$.extend({date:null,offset:null},options);if(!settings.date){$.error("Date is not defined.")}if(!Date.parse(settings.date)){$.error("Incorrect date format, it should look like this, 12/24/2012 12:00:00.")}var container=this;var currentDate=function(){var date=new Date();var utc=date.getTime()+(date.getTimezoneOffset()*60000);var new_date=new Date(utc+(3600000*settings.offset));return new_date};function countdown(){var target_date=new Date(settings.date),current_date=currentDate();var difference=target_date-current_date;if(difference<0){clearInterval(interval);if(callback&&typeof callback==="function"){callback()}return}var _second=1000,_minute=_second*60,_hour=_minute*60,_day=_hour*24;var days=Math.floor(difference/_day),hours=Math.floor((difference%_day)/_hour),minutes=Math.floor((difference%_hour)/_minute),seconds=Math.floor((difference%_minute)/_second);days=(String(days).length>=2)?days:"0"+days;hours=(String(hours).length>=2)?hours:"0"+hours;minutes=(String(minutes).length>=2)?minutes:"0"+minutes;seconds=(String(seconds).length>=2)?seconds:"0"+seconds;container.find(".days").text(days);container.find(".hours").text(hours);container.find(".minutes").text(minutes);container.find(".seconds").text(seconds);container.find(".days_ref").text("天");container.find(".hours_ref").text("时");container.find(".minutes_ref").text("分");container.find(".seconds_ref").text("秒")}var interval=setInterval(countdown,1000)}})(jQuery);